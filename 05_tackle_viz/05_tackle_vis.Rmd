```{r set-options, echo=FALSE, cache=FALSE}
options(width = 80)
```
![](https://raw.githubusercontent.com/jliberma/rugby7s/master/graphics/s7-analysis.png)
<hr>
---
output:
  pdf_document: default
  html_document:
    number_sections: yes
    theme: readable
---

# Visualizing Directional Tackle Data

This article describes an approach to visualizing tackle data. We use a clock face metaphor to categorize the tackler's angle of approach. The ball carrier's running line is always 12 o'clock. The defender's *tracking angle* is the clock face number corresponding to the tackler's angle of approach relative to the ball carrier's running line. 6 is directly behding the ball carrier. 12 is directly in front, and so on.

We use example data and code to demonstrate tackle visualization by tracking angle. First team tackle data is considered. Then player data.

***
### Visualizing team tackles
In this section we analyze team directional tackle data. First we generate tackle data to simulate a contest. Next we plot made and missed tackles in a bar chart. Then we plot the same data in a polar coordinate chart to visualize tackle directions.

1. Load supporting libraries for displaying and manipulating the data.
```{r, message=FALSE}
library(dplyr)
library(ggplot2)
library(tidyr)
```

2. Simulate tackle data by generating a random matrix of tackle attempts from each direction.
```{r}
set.seed(9940)
T <- data.frame(dir = 1:12, att = sample(5:12, 12, replace=TRUE))
head(T, 5)
```

3. Divide the attempts into made and missed tackles. Then calculate the _tackle efficiency_ for each direction. Tackle efficiency is the ratio between made and missed tackles. An efficiency of 1.0 means the team made every tackle from that direction.
```{r}
T <- T %>% 
  mutate(made = att - ceiling(att*runif(12, 0, .3))) %>% 
  mutate(miss = att - made) %>%
  mutate(eff = round(made/att,2)) 

T$eff[is.nan(T$eff)] <- NA
```

4. Calculate cumulative tackle statistics for all directions: attempts, made, and efficiency.
```{r}
tmade <- sum(T$made)
tatt <- sum(T$att)
eff <- round(tmade/tatt,2)
cat("Attempts:", tatt, "\nMade:", tmade, "\nEfficiency:", eff)
```

5. Put the data in _long_ format so we can plot it in a stacked bar chart. 
```{r}
Tl <- T %>% 
  gather(res, count, made:miss) %>% 
  select(dir, res, count)
head(Tl, 5)
```

6. Visualize team tackle data in a stacked bar chart.
``` {r}
  ggplot(Tl, aes(factor(dir), count, fill=factor(res))) + 
  geom_bar(width=.75, stat="identity") +
  scale_fill_grey(name="Tackle\nResult", start=.5, end=.1) + 
  xlab("Direction") +
  ylab("Tackle Count") +
  ggtitle("Tackle Attempts by Direction")
```

This chart plots made and missed tackles by direction. The number of tackle attempts in each direction determines bar height.

7. Visualize the same data in a polar coordinate chart. This chart maps the frequency of tackles made and missed to the defender's tracking angle.
```{r}
ggplot(Tl, aes(factor(dir), count, fill=factor(res))) + 
  geom_bar(width=1, stat="identity", color="white") + coord_polar() + 
  scale_fill_grey(name="Tackle\nResult", start=.5, end=.1) + 
  theme(axis.ticks=element_blank(), 
        axis.text.y=element_blank(),
        axis.title.y=element_blank(),
        axis.title.x=element_blank()) + 
  ggtitle("Tackle Attempts by Direction")
```

The polar coordinate chart and the bar chart show the same data. The polar coordinate chart makes it easier to visualize the directional tackle data. The tackle attempt frequency increases as we move from the center of the chart. The different colors represent the number of tackles made and missed in each direction.

***

### Visualizing player tackles

In this section we apply the same tackle visualization techniques to individual players.

1. Build a data frame for the team. Each player has a name, number, and position.
```{r}
names <- c("Sherwood", "Liberman", "Woodman", "Frieden", "Kivell", "Meyer", "Soto", "Steanson", "Hoetger", "Laibowitz", "Christie")
numbers=c("33", "44", "16", "40", "20", "35", "56", "87", "70", "41", "87")
position=c("LB", "DB", "DB", "DL", "LB", "DB", "LB", "LB", "DL", "DL", "DL")
team <- data.frame("name"=names, "number"=numbers, "position"=position)
```

2. This code blocks simulates tackles. Each player attempts 0-9 tackles in each direction and completes a percentage of them.
```{r}
player_tackle_attempts <- matrix(sample(0:9, 132, replace=TRUE), 
                                 ncol=12, nrow=11)
player_tackles_made <- 
  ceiling(player_tackle_attempts-player_tackle_attempts * runif(length(player_tackle_attempts),
                                                              0, .6))
```

3. Clean the tackle data: add column/row names and replace NAs with 0s for tackles made.
```{r}
player_tackles_made[is.na(player_tackles_made)] <- 0
colnames(player_tackle_attempts) <- paste(1:12, "ta", sep="")
colnames(player_tackles_made) <- paste(1:12, "tm", sep="")
```

3. Create a tackle efficiency matrix. For each direction, divide tackles made by tackle attempts.
```{r}
player_tackles <- round(player_tackles_made/player_tackle_attempts,2)
colnames(player_tackles)<-c(1:12)
team_tackles <- cbind(team,player_tackles)
head(team_tackles)
```

4. Calculate directional tackle efficiency for each player.
```{r}
player_eff <- round(apply(player_tackles_made, 1, sum)/apply(player_tackle_attempts, 1, sum),2)
```

4. Specify the location of the background grid prior to visualizing the tackle data.
```{r}
locations <- matrix(c(2,4,6,8,2,4,6,8,2,4,6,6,6,6,6,4,4,4,4,2,2,2), ncol=2, nrow=11)
circles <- matrix(1.0, ncol=12, nrow=11)
circles[is.nan(player_tackles[,1:12])] <- 0
circles
```

The spokes of the background circle represent all of the tackle attempts from that direction. No spoke is drawn for directions where no tackles were attempted.

5. Plot directional player tackle efficiency on top of the background grid. The black spoke length represents the percentage of tackles made in each direction. 
```{r}
stars(circles, radius=TRUE, draw.segments=FALSE, locations=locations,
      labels=paste(numbers, names, player_eff), flip.labels=FALSE, scale=FALSE, len=.75,
      main = bquote("Directional Tackle" ~ epsilon ~ "by Player"))

stars(team_tackles[,c(6:4,15:7)], draw.segments=FALSE, scale=FALSE, 
      radius=TRUE, key.loc=c(8,2), labels=NULL, locations=locations,
      len=.75, lwd=2, add=TRUE, frame.plot=TRUE)
```

Each chart represents a player. The black spokes plot tackle completion percentage. The gray spokes represent all attempts in each direction. The player made 100% of his tackles in the directions where the black spoke completely covers the gray spoke. Empty sections in the chart mean the player did not attempt any tackles in that direction. 

Hoetger, for example, completed 100% of his tackle attempts from directions 12, 9, 8, and 3. He did not have any attempts from direction 5. His lowest percentage directions were 7, 3, and 2. 

6. Calculate summary statistics for most efficienct player, and most/least efficient direction for the whole team.
```{r}
dir_eff <- round(apply(player_tackles_made, 2, sum)/apply(player_tackle_attempts, 2, sum),2)
max_dir <- paste(which.max(dir_eff), "(", max(dir_eff), ")")
min_dir <- paste(which.min(dir_eff), "(", min(dir_eff), ")")
max_player <- paste(names[which.max(player_eff)], ":", max(player_eff))
```

Most efficient player: `r max_player`  
Most efficienct direction (all players): `r max_dir`  
Least efficient direction (all players): `r min_dir`  

***
### Discussion

This article demonstrates how to quantify and visualize tackle directional tackle data from rugby or American football. Coaches can analyze individual players, positions, or the entire team, and apply the results to practice planning, player selections, and game planning.

Classifying tackles by direction reveals:

1. Angle frequency
2. Strong/weak angles
3. Shoulder preference

We use a polar coordinate plot to visualize tackle attempts and completions by direction. The individual player plots visualize tackle efficiency in each direction. However, the player graph can be used to summarize team tackle efficiency, and the team graph can be used to quantify tackle attempts for individual players.

